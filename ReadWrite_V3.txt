
{
  "schema": "1.0",
  "name": "Mail_ReadWrite_V3",
  "version": "3.0.0",
  "description": "Lire, rechercher, envoyer, répondre, transférer et gérer des courriels au nom de l'utilisateur via Microsoft Graph",
  "publisher": "TonOrganisation",
  "authentication": {
    "type": "OAuth2",
    "provider": "Microsoft",
    "delegated": true,
    "resource": "https://graph.microsoft.com",
    "scopes": ["Mail.ReadWrite", "Mail.Send", "User.Read"]
  },
  "actions": [
    {
      "name": "ListInboxMessages",
      "description": "Lister les messages récents de la boîte de réception",
      "method": "GET",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/mailFolders/Inbox/messages?$top={top}&$orderby=receivedDateTime desc&$select=id,subject,from,receivedDateTime,isRead",
      "parameters": [
        { "name": "top", "type": "number", "required": false, "default": 10, "min": 1, "max": 50 }
      ],
      "output": {
        "type": "object",
        "schema": {
          "messages": [
            {
              "id": "string",
              "subject": "string",
              "from": { "emailAddress": { "name": "string", "address": "string" } },
              "receivedDateTime": "string",
              "isRead": "boolean"
            }
          ]
        }
      }
    },
    {
      "name": "GetMessage",
      "description": "Obtenir les détails d'un message (avec corps)",
      "method": "GET",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}?$select=id,subject,from,toRecipients,ccRecipients,receivedDateTime,bodyPreview,body",
      "parameters": [
        { "name": "messageId", "type": "string", "required": true, "description": "ID du message" }
      ],
      "output": {
        "type": "object",
        "schema": {
          "id": "string",
          "subject": "string",
          "from": { "emailAddress": { "name": "string", "address": "string" } },
          "toRecipients": [{ "emailAddress": { "name": "string", "address": "string" } }],
          "ccRecipients": [{ "emailAddress": { "name": "string", "address": "string" } }],
          "receivedDateTime": "string",
          "bodyPreview": "string",
          "body": { "contentType": "string", "content": "string" }
        }
      }
    },
    {
      "name": "SearchMessages",
      "description": "Rechercher des courriels par mot-clé dans la boîte aux lettres",
      "method": "GET",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages?$search=\"{query}\"&$top={top}&$select=id,subject,from,receivedDateTime,bodyPreview",
      "headers": [
        { "name": "ConsistencyLevel", "value": "eventual" }
      ],
      "parameters": [
        { "name": "query", "type": "string", "required": true, "description": "Mot-clé(s), ex. \"facture\", \"projet X\"" },
        { "name": "top", "type": "number", "required": false, "default": 10, "min": 1, "max": 50 }
      ],
      "output": {
        "type": "object",
        "schema": {
          "messages": [
            {
              "id": "string",
              "subject": "string",
              "from": { "emailAddress": { "name": "string", "address": "string" } },
              "receivedDateTime": "string",
              "bodyPreview": "string"
            }
          ]
        }
      }
    },
    {
      "name": "SendMail",
      "description": "Envoyer un courriel au nom de l'utilisateur",
      "method": "POST",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/sendMail",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "to", "type": "array", "items": { "type": "string" }, "required": true, "description": "Adresses des destinataires" },
        { "name": "subject", "type": "string", "required": true },
        { "name": "body", "type": "string", "required": true, "description": "Corps du message (HTML autorisé)" },
        { "name": "cc", "type": "array", "items": { "type": "string" }, "required": false },
        { "name": "bcc", "type": "array", "items": { "type": "string" }, "required": false }
      ],
      "bodyTemplate": "{ \"message\": { \"subject\": \"{subject}\", \"body\": { \"contentType\": \"HTML\", \"content\": \"{body}\" }, \"toRecipients\": [ {\"emailAddress\": {\"address\": \"{to}\"}} ], \"ccRecipients\": [ {\"emailAddress\": {\"address\": \"{cc}\"}} ], \"bccRecipients\": [ {\"emailAddress\": {\"address\": \"{bcc}\"}} ] }, \"saveToSentItems\": true }",
      "output": { "type": "object", "schema": { "status": "string" } }
    },
    {
      "name": "ReplyToMessage",
      "description": "Répondre à un message au nom de l'utilisateur",
      "method": "POST",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}/reply",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "messageId", "type": "string", "required": true },
        { "name": "comment", "type": "string", "required": true, "description": "Contenu de la réponse (HTML autorisé)" }
      ],
      "bodyTemplate": "{ \"comment\": \"{comment}\" }",
      "output": { "type": "object", "schema": { "status": "string" } }
    },
    {
      "name": "ForwardMessage",
      "description": "Transférer un message au nom de l'utilisateur",
      "method": "POST",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}/forward",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "messageId", "type": "string", "required": true },
        { "name": "to", "type": "array", "items": { "type": "string" }, "required": true, "description": "Adresses des destinataires" },
        { "name": "comment", "type": "string", "required": false }
      ],
      "bodyTemplate": "{ \"comment\": \"{comment}\", \"toRecipients\": [ {\"emailAddress\": {\"address\": \"{to}\"}} ] }",
      "output": { "type": "object", "schema": { "status": "string" } }
    },
    {
      "name": "MarkAsRead",
      "description": "Marquer un message comme lu",
      "method": "PATCH",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "messageId", "type": "string", "required": true }
      ],
      "bodyTemplate": "{ \"isRead\": true }",
      "output": { "type": "object", "schema": { "id": "string", "isRead": "boolean" } }
    },
    {
      "name": "MarkAsUnread",
      "description": "Marquer un message comme non lu",
      "method": "PATCH",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "messageId", "type": "string", "required": true }
      ],
      "bodyTemplate": "{ \"isRead\": false }",
      "output": { "type": "object", "schema": { "id": "string", "isRead": "boolean" } }
    },
    {
      "name": "MoveMessage",
      "description": "Déplacer un message vers un dossier spécifié",
      "method": "POST",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/messages/{messageId}/move",
      "headers": [
        { "name": "Content-Type", "value": "application/json" }
      ],
      "parameters": [
        { "name": "messageId", "type": "string", "required": true },
        { "name": "destinationFolderId", "type": "string", "required": true, "description": "ID du dossier destination (ex. Archive)" }
      ],
      "bodyTemplate": "{ \"destinationId\": \"{destinationFolderId}\" }",
      "output": { "type": "object", "schema": { "id": "string", "parentFolderId": "string" } }
    },
    {
      "name": "ListFolders",
      "description": "Lister les dossiers de la boîte aux lettres",
      "method": "GET",
      "urlTemplate": "https://graph.microsoft.com/v1.0/me/mailFolders?$top={top}&$select=id,displayName,childFolderCount",
      "parameters": [
        { "name": "top", "type": "number", "required": false, "default": 25, "min": 1, "max": 100 }
      ],
      "output": {
        "type": "object",
        "schema": {
          "folders": [
            { "id": "string", "displayName": "string", "childFolderCount": "number" }
          ]
        }
      }
    }
  ]
}
